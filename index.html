<!DOCTYPE html>

<head>
    <title>
        Guess My Breed
    </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <style>
        #title {
            text-align: center;
        }

        #imageToGuess {
            display: none;
            height: 300px;
        }

        #logo {
            height: 50px;
        }

        #guessDogBreedInput {
            margin-bottom: 20px;
        }

        * {
            margin-bottom: 20px;
        }
    </style>
    <script>

        let breedNamesList = []
        let breedToGuess;
        let imageToGuess;
        let gameStarted = false
        let isGuessing = false
        let score;
        const duration = 30
        let myModal;

        window.onload = init()

        async function init() {
            const breedsResponse = await fetch('https://dog.ceo/api/breeds/list/all')
            breedsJson = await breedsResponse.json()
            breedNamesList = Object.keys(breedsJson.message)
            myModal = new bootstrap.Modal('#myModal', { keyboard: false })
        }

        function getRandomBreedName() {
            var breedName = breedNamesList[Math.floor(Math.random() * breedNamesList.length)];
            return breedName
        }

        async function imageExists(imageUrl) {
            try {
                const imageUrlResponse = await fetch(imageUrl)
            }
            catch (exception) {
                return false;
            }
            return true
        }

        async function getRandomImageByBreed(breed) {
            const imagesResponse = await fetch(`https://dog.ceo/api/breed/${breed}/images/random`)
            const imagesJson = await imagesResponse.json()
            const imagePath = imagesJson.message
            return imagePath
        }

        async function loadNewDog() {
            document.getElementById('helperText').innerText = ''
            breedToGuess = await getRandomBreedName().trim()
            imageToGuess = await getRandomImageByBreed(breedToGuess)
            if (await imageExists(imageToGuess)) {
                document.getElementById('imageToGuess').src = imageToGuess
            }
            else {
                await loadNewDog()
            }
        }

        function msToSeconds(ms) {
            return ms / 1000
        }

        function secondsToMs(sec) {
            return sec * 1000
        }

        function decrementTime() {
            timeLeft -= 1
            document.getElementById('timeLeft').innerText = timeLeft
        }

        async function startGame() {
            myModal.hide()
            score = 0
            timeLeft = duration
            document.getElementById('score').innerText = score
            document.getElementById('timeLeft').innerText = timeLeft
            gameStarted = true
            document.getElementById("startButton").disabled = true
            await loadNewDog()
            document.getElementById("imageToGuess").style.display = 'inline'
            const interval = setInterval(function () {
                decrementTime()
                if (timeLeft === 0) {
                    clearInterval(interval)
                    document.getElementById("finalScoreMessage").innerText = 'Final score: ' + score
                    myModal.show()
                }
            }, secondsToMs(1))
        }

        async function pass() {
            await loadNewDog()
        }

        async function guessBreed() {
            const currentBreedGuess = document.getElementById('guessDogBreedInput').value.trim().toLowerCase()
            if (currentBreedGuess === breedToGuess) {
                document.getElementById('helperText').innerText = ''
                score++
                document.getElementById('score').innerText = score
                await loadNewDog()
            }
            else if (currentBreedGuess.includes(breedToGuess) || breedToGuess.includes(currentBreedGuess)) {
                document.getElementById('helperText').innerText = 'You are warm, keep guessing!'
            }
            else {
                document.getElementById('helperText').innerText = 'Cold, try again!'
            }
        }
    </script>
</head>

<body>
    <div class="container mx-auto p-2" style="width: 50%">
        <h1 id="title">Guess My Breed <img id="logo" class="img-fluid" src="paw.png" /></h1>
        Score: <p id="score">0</p>
        Time left: <p id="timeLeft">0</p>
        <img id="imageToGuess" src="" alt="dog image goes here" class="img-fluid" />
        <p id="helperText"></p>
        <input id="guessDogBreedInput" placeholder="Guess dog breed and click guess button" class="form-control" />
        <button type="button" class="btn btn-primary" onclick="guessBreed()">Guess</button>
        <button type="button" class="btn btn-primary" onclick="pass()">Pass</button>
        <button id="startButton" type="button" class="btn btn-primary" onclick="startGame()">Start</button>
    </div>
    <div id="myModal" class="modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Game Over!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="finalScoreMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save score</button>
                    <button type="button" class="btn btn-primary" onclick="startGame()">Play Again!</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
</body>

</html>